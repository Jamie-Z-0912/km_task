
(function($){$.fn.slTime=function(options){var opts=$.extend({},$.fn.slTime.defaults,options);$(this).removeData("opts");$(this).data("opts",opts);if($(this).slTime.opts!=opts){$(this).slTime.opts=opts;switch($(this).slTime.opts.triEvent){case"click":$(this).unbind("click");$(this).click(function(){$(this).slTime.opts=$(this).data("opts");InitHandle($(this));if(!!$(this).attr("datetype")&&$(this).attr("datetype")=="lunarDate"){$(".jp_content #clSwitch2").click()}});break;case"focus":$(this).unbind("focus");$(this).focus(function(){$(this).slTime.opts=$(this).data("opts");InitHandle($(this));if(!!$(this).attr("datetype")&&$(this).attr("datetype")=="lunarDate"){$(".jp_content #clSwitch2").click()}});break;default:return}}
if(this[0].nodeName.toLowerCase()=="input"&&this[0].value==""){$(this).val(new Date().format("yyyy-MM-dd 00:00:00"))}};function InitHandle($this){jp_currentDate=new Date();jp_madeRiliDate=new Date();jp_showingToday=true;if($(this).slTime.opts.defualtShowSD){_isShowLunar=false}else{_isShowLunar=true}
var dateType=$this.attr("datetype");var date;if(!!dateType){date=$this.attr(dateType);date=new Date(date.replace(/-/g,"/"));if(dateType=="lunarDate"){var dateS=getSolarDate(date.getFullYear(),date.getMonth()+1,date.getDate(),false);dateS.setHours(date.getHours());dateS.setMinutes(date.getMinutes());dateS.setSeconds(date.getSeconds());date=dateS}}else{if($this[0].nodeName.toLowerCase()=="input"&&$this[0].value!=""){date=new Date($this[0].value.replace(/-/g,"/"))}}
$(this).slTime.init($(this).slTime.opts.showTime,$(this).slTime.opts.format,date);if($(this).slTime.opts.lunar!=undefined&&!$(this).slTime.opts.lunar){$(".jp_content #clSwitch1").parent().hide();$(".jp_content .cla_head_layout").css("margin-right","85px")}else{$(".jp_content .cla_head_layout").css("margin-right","0")}
position($(".jp_content"),$this);if($.browser.msie&&parseInt($.browser.version)<=6||(!!$this.data("opts").position&&$this.data("opts").position=="absolute")){$(window).unbind("scroll.sl-time");$(window).bind("scroll.sl-time",function(){position($(".jp_content"),$this)})}
$(window).unbind("resize.sl-time");$(window).bind("resize.sl-time",function(){setTimeout(function(){position($(".jp_content"),$this)},40)});slTimeObj.target=$this;if(_isShowLunar){$(".jp_content #clSwitch1").removeClass("active");$(".jp_content #clSwitch2").addClass("active")}else{$(".jp_content #clSwitch2").removeClass("active");$(".jp_content #clSwitch1").addClass("active")}
addCalWarp()}
function getInputPosition($obj){var offset=$obj.offset();return{left:offset.left,top:offset.top}}
function position($obj,$input){if($obj.length<=0){return}
var position=getInputPosition($input);var isIE6=($.browser.msie&&parseInt($.browser.version)<=6)?true:false;var border_width=parseFloat($input.css("border-top-width"))*2;if(!border_width){border_width=0}
var height=$input.height()+parseFloat($input.css("padding-bottom"))*2+border_width;var windowHeight=$(window).height();var objHeight=$obj.height();var scrollTop=$(document).scrollTop();if(windowHeight>(position.top+height+objHeight-scrollTop)){if(isIE6||(!!$input.data("opts").position&&$input.data("opts").position=="absolute")){$obj.css({left:position.left+"px",top:position.top+height+"px",display:"block",position:"absolute"})}else{$obj.css({left:position.left+"px",top:(position.top+height-scrollTop)+"px",display:"block"})}}else{if(isIE6||(!!$input.data("opts").position&&$input.data("opts").position=="absolute")){$obj.css({left:position.left+"px",top:position.top-objHeight+"px",display:"block",position:"absolute"})}else{$obj.css({left:position.left+"px",top:(position.top-objHeight-scrollTop)+"px",display:"block"})}}}
function addCalWarp(){if($(".jp_bodyCeng").length==0){var bodyCeng=$("<div class='jp_bodyCeng'></div>");if($("#alertModal").length>0){bodyCeng.css({height:$("html").height()+"px","z-index":9998})}else{bodyCeng.css({height:$("html").height()+"px"})}
$("body").append(bodyCeng)}
$(".jp_bodyCeng").bind("click",function(){$(this).remove();closeCalendar()})}
$.fn.slTime.defaults={showTime:true,triEvent:"focus",format:"yyyy-MM-dd hh:mm:ss",callback:null,defualtShowSD:true,lunar:false};$.fn.slTime.opts=[]})(jQuery);var slTimeObj={self:$(".jp_content"),target:null};$.fn.slTime.init=function(showTime,format,assignTime){if($(".jp_content").length==0){$("body").append("<div class='jp_content'>                 <div class='clearfix can_haedw'>                  <span class='fll'>                   <button id='clSwitch1' class='solarBtn active'>公历</button><button id='clSwitch2' class='lodarBtn'>农历</button>                  </span>                  <span class='ymd-w cla_head_layout'>                   <a href='javascript:;' id='prevBtn_a' class='prevBtn'></a>                   <span class='dropdown'>            <span id='year_func'>                  <span id='year_type' class='nong'></span>                  <span id='jpyear_num'>2012</span>                  <span id='year_str'>年</span>                 </span>                 <ul class='dropdown-menu'>                  <li class='year_funcless'><a href='#' class='up'></a></li>                  <li class='timeItem'><a href='#' class='pl9IE7'>2010</a></li>                  <li class='timeItem'><a href='#' class='pl9IE7'>2011</a></li>                  <li class='timeItem'><a href='#' class='pl9IE7'>2012</a></li>                  <li class='timeItem'><a href='#' class='pl9IE7'>2013</a></li>                  <li class='timeItem'><a href='#' class='pl9IE7'>2014</a></li>                  <li class='timeItem'><a href='#' class='pl9IE7'>2015</a></li>                  <li class='year_funcmore'><a href='#' class='down'></a></li>                 </ul>                </span>                <span class='dropdown'>                 <span id='month_func'>                  <span id='jpmonth_num'>8</span>                  <span id='month_str'>月</span>                 </span>                 <ul class='dropdown-menu'>                  <li class='month_funcless'><a href='#' class='up'></a></li>                  <li class='timeItem'><a href='#' class='pl13IE7'>01</a></li>                  <li class='timeItem'><a href='#' class='pl13IE7'>02</a></li>                  <li class='timeItem'><a href='#' class='pl13IE7'>03</a></li>                  <li class='timeItem'><a href='#' class='pl13IE7'>04</a></li>                  <li class='timeItem'><a href='#' class='pl13IE7'>05</a></li>                  <li class='timeItem'><a href='#' class='pl13IE7'>06</a></li>                  <li class='month_funcmore'><a href='#' class='down'></a></li>                 </ul>                </span>                <a href='javascript:;' id='nextBtn_a' class='nextBtn'></a>          </span>            <span id='jptoday_button'>今天</span>                 </div>                 <div class='jpcontent'>                  <div id='cal_downleft'>                   <div id='jp_mainCal'></div>                  </div>                  <div class='can_right'>                   <div id='cal_rightboard'>                    <div id='gregorianDayStr'></div>                    <div class='chinaDay' id='chinaDay'></div>                    <div class='time' id='time'>                     <span id='hour_func'>12</span>                     <input type='text' class='timeInput' id='hour_input' maxlength='2' />             <span style='font-size:16px;'>:</span>         <span id='minute_func'>00</span>                     <input type='text' class='timeInput' id='minute_input' maxlength='2' />                    </div>                   </div>                   <div class='cal_btn_w'><button id='sure' class='button_ok inlineblock'></button>&nbsp;<button id='cancel' class='button_cancel inlineblock'></button></div>                  </div>                  <div class='clearfloat'></div>                 </div>             </div>")}
var nowDate=new Date();if(!!assignTime){nowDate=assignTime}
if(showTime){$(".jp_content #hour_func").text(nowDate.getHours().toString().leftpad(2));$(".jp_content #minute_func").text(nowDate.getMinutes().toString().leftpad(2))}else{$(".jp_content #time").remove()}
jp_makeCal.init(assignTime);$(".jp_content button[id*='clSwitch']").bind("click",function(){if($(this).hasClass("active")){return}else{$(".jp_content button[id*='clSwitch']").removeClass("active");$(this).addClass("active")}
var nowSelectTime=jp_calData[_selectDateIJ.i][_selectDateIJ.j];if($(this).attr("id")=="clSwitch1"){if(_isShowLunar){_isShowLunar=false;jp_currentDate=getSolarDate(nowSelectTime.year,nowSelectTime.month+1,nowSelectTime.date,false);jp_calander.showCalendar(jp_currentDate);$(".jp_content #year_type").text("")}}else{if(!_isShowLunar){_isShowLunar=true;var lunarToSolarFirstDay=new Date();lunarToSolarFirstDay.setFullYear(nowSelectTime.china.l_year);lunarToSolarFirstDay.setMonth(nowSelectTime.china.l_month-1);lunarToSolarFirstDay.setDate(nowSelectTime.china.l_Numday);jp_currentDate=lunarToSolarFirstDay;jp_calander.showLunar(lunarToSolarFirstDay);$(".jp_content #year_type").text("农")}}});$(".jp_content #year_func").bind("click",function(event){var $parent=$(this).parent();$parent.addClass("open");var $next=$(this).next();if(parseInt($(this).css("margin-left"))>0){$next.css("left",$(this).css("margin-left"))}
$next.children().not("[class*="+$(this).attr("id")+"]").bind("click",function(event){var year=parseInt($(this).text());$(".jp_content #year_num").text(year);selectYearOrMonth(true,year);$(this).parents(".open").removeClass("open");event.stopPropagation()});$next.children("."+$(this).attr("id")+"more").bind("click",function(event){var _this=$(this);$(this).siblings("li").find("a").each(function(){var year=parseInt($(this).text())+3;if(year>2070){setMaxYear(_this);return false}
$(this).text(year)});function setMaxYear($this){var year=2064;$this.siblings("li").find("a").each(function(){$(this).text(year++)});alert("我们提供是时间年限为1901年至2070年")}
event.stopPropagation()});$next.children("."+$(this).attr("id")+"less").bind("click",function(event){var _this=$(this);$(this).siblings("li").find("a").each(function(){var year=parseInt($(this).text())-3;if(year<1901){setMinYear(_this);return false}
$(this).text(year)});function setMinYear($this){var year=1901;$this.siblings("li").find("a").each(function(){$(this).text(year++)});alert("我们提供是时间年限为1901年至2070年")}
event.stopPropagation()});event.stopPropagation()});var _chazhi_month=-1;$(".jp_content #month_func").bind("click",function(event){var $next=$(this).next();if(_chazhi_month==-1){var nowDate=new Date();_chazhi_month=nowDate.getMonth()+1-3;$next.children().find("a").each(function(){var number=(parseFloat($(this).text())+_chazhi_month);$(this).text(((number==0?12:number)+"").leftpad(2))})}
var $parent=$(this).parent();$parent.addClass("open");if(parseInt($(this).css("margin-left"))>0){$next.css("left",$(this).css("margin-left"))}
$next.children().not("[class*="+$(this).attr("id")+"]").bind("click",function(event){var month=$(this).text();$(".jp_content #month_num").text(month);month=parseFloat(month);selectYearOrMonth(false,month-1);$(this).parents(".open").removeClass("open");event.stopPropagation()});$next.children("."+$(this).attr("id")+"more").bind("click",function(event){$(this).siblings("li").each(function(){$(this).find("a").text(((parseFloat($(this).text())+2)%12+1+"").leftpad(2))});event.stopPropagation()});$next.children("."+$(this).attr("id")+"less").bind("click",function(event){$(this).siblings("li").each(function(){$(this).find("a").text(((parseFloat($(this).text())-3+11)%12+1+"").leftpad(2))});event.stopPropagation()});event.stopPropagation()});if(showTime){$(".jp_content #hour_func").bind("click",function(event){var $this=$(this);var $next=$this.next();$this.hide();$next.show();$next.val($this.text());$next[0].focus();$next.blur(function(){var hour=0;try{hour=parseFloat($(this).val())}catch(e){alert("时间格式转化错误");$(this)[0].focus();return}
if(hour>=0&&hour<=23){$this.text(hour.toString().leftpad(2));$(this).hide();$(this).prev().show()}else{alert("时间格式转化错误");$(this)[0].focus();return}})});$(".jp_content #minute_func").bind("click",function(event){var $this=$(this);var $next=$this.next();$this.hide();$next.show();$next.val($this.text());$next[0].focus();$next.blur(function(){var minute=0;try{minute=parseFloat($(this).val())}catch(e){alert("时间格式转化错误");$(this)[0].focus();return}
if(minute>=0&&minute<=59){$this.text(minute.toString().leftpad(2));$(this).hide();$(this).prev().show()}else{alert("时间格式转化错误");$(this)[0].focus();return}})})}
$("body").bind("click",function(){$(".open").removeClass("open")});$(".jp_content").find("#sure").unbind();$(".jp_content").find("#sure").click(function(){if($(".jp_content").length==0){return false}
var cal_date=jp_calData[_selectDateIJ.i][_selectDateIJ.j].value;if(_isShowLunar){var lunar=cal_date;if(showTime){lunar.setHours(parseFloat($(".jp_content #hour_func").text()));lunar.setMinutes(parseFloat($(".jp_content #minute_func").text()))}
var lunar_format=lunar.format(format);var month_value=$(".jp_content #chinaDay").text().substring(2);var lunar_value=lunar.format("yyyy-MM-dd hh:mm:ss");if(slTimeObj.target[0].nodeName.toLowerCase()=="input"){slTimeObj.target.attr("value",lunar_value)}else{slTimeObj.target.text("农历:"+lunar_format)}
slTimeObj.target.attr("lunarDate",lunar_format);var solar=getSolarDate(cal_date.getFullYear(),cal_date.getMonth()+1,cal_date.getDate(),false);if(showTime){solar.setHours(parseFloat($(".jp_content #hour_func").text()));solar.setMinutes(parseFloat($(".jp_content #minute_func").text()))}
slTimeObj.target.attr("solarDate",solar.format(format));slTimeObj.target.attr("datetype","lunarDate")}else{if(showTime){cal_date.setHours(parseFloat($(".jp_content #hour_func").text()));cal_date.setMinutes(parseFloat($(".jp_content #minute_func").text()))}
var solar_value;var cal_dateFormat;var checkTime=$("#checkTimeJS").val();if(checkTime){solar_value=cal_date.format("yyyy-MM-dd");cal_dateFormat=cal_date.format(format)}else{solar_value=cal_date.format("yyyy-MM-dd hh:mm:ss");cal_dateFormat=cal_date.format(format)}
if(slTimeObj.target[0].nodeName.toLowerCase()=="input"){slTimeObj.target.attr("value",solar_value)}else{slTimeObj.target.text(cal_dateFormat)}
slTimeObj.target.attr("solarDate",cal_dateFormat);var lunar=new jp_Lunar(cal_date);var lunarDate=cal_date;lunarDate.setFullYear(lunar.year);lunarDate.setMonth(lunar.month);lunarDate.setDate(lunar.day);if(showTime){lunarDate.setHours(parseFloat($(".jp_content #hour_func").text()));lunarDate.setMinutes(parseFloat($(".jp_content #minute_func").text()))}
slTimeObj.target.attr("lunarDate",lunarDate.format(format));slTimeObj.target.attr("datetype","solarDate")}
if(!!$(this).slTime.opts.callback){$(this).slTime.opts.callback()}
closeCalendar()});$(".jp_content").find("#cancel").unbind();$(".jp_content").find("#cancel").bind("click",function(){closeCalendar()})};function closeCalendar(){$(".jp_content").remove();if($(".jp_bodyCeng").length>0){$(".jp_bodyCeng").remove()}
$(window).unbind("scroll.sl-time");$(window).unbind("resize.sl-time");return false}
function selectYearOrMonth(isYear,number){var selectDate=jp_currentDate;if(isYear){selectDate.setFullYear(number)}else{selectDate.setMonth(number)}
selectDate=jp_calander.setTimeZero(selectDate);jp_makeCal.pareData(selectDate);jp_makeCal.showCal(selectDate);jp_makeCal.makeHuangli(selectDate)}
var jp_calData=new Array();var jp_currentDate=new Date();var jp_rows;var jp_showingToday=true;var jp_madeRiliDate=new Date();var jp_record={elem_id:"",nav_date:new Date()};var _isShowLunar=false;var _selectDateIJ={i:0,j:0};var jp_calander={init:function(assignTime){var date=new Date();if(!!assignTime){date=assignTime}
jp_makeCal.pareData(date);jp_makeCal.showCal(date);jp_makeCal.initAction();jp_makeCal.makeHuangli(jp_currentDate)},pareData:function(date){date=jp_makeCal.setTimeZero(date);jp_madeRiliDate=new Date(date);var monthFirstD=jp_makeCal.getMonthFirst(date);var tableFirstD=jp_makeCal.getWeekFirst(monthFirstD);var nextMonthFirstD=jp_makeCal.addTime(monthFirstD,1,"month");var monthLastD=jp_makeCal.addTime(nextMonthFirstD,-1,"day");var daysLunar=monthDays(date.getFullYear(),date.getMonth()+1);var daysSolar=getDaysByMonth(date);if(_isShowLunar){var chazhi=daysSolar-daysLunar;jp_rows=Math.ceil(((nextMonthFirstD.valueOf()-tableFirstD.valueOf())/(60*60*24*1000)-chazhi)/7)}else{jp_rows=Math.ceil((nextMonthFirstD.valueOf()-tableFirstD.valueOf())/(60*60*24*1000*7))}
var indexDay=new Date(tableFirstD);var nowDay=jp_makeCal.setTimeZero(new Date());if(_isShowLunar){jp_makeCal.fillCalData(indexDay,monthFirstD,monthLastD,nowDay,daysLunar)}else{jp_makeCal.fillCalData(indexDay,monthFirstD,monthLastD,nowDay,daysSolar)}},fillCalData:function(indexDay,monthFirstD,monthLastD,nowDay,daysLunar){jp_calData=[];var days=0;for(var i=0;i<jp_rows;i++){var week=[];for(var j=0;j<7;j++){if(indexDay.getTime()<monthFirstD.getTime()){week.push(null)}else{if(daysLunar<=days){break}
var aDay=jp_makeCal.createDay();aDay.year=indexDay.getFullYear();aDay.month=indexDay.getMonth();aDay.date=indexDay.getDate();if(!_isShowLunar&&indexDay.getTime()==nowDay.getTime()){aDay.today=true;_selectDateIJ.i=i;_selectDateIJ.j=j}
if(_isShowLunar&&getSolarDate(aDay.year,aDay.month+1,aDay.date,false).getTime()==nowDay.getTime()){aDay.today=true;_selectDateIJ.i=i;_selectDateIJ.j=j}
if(j==5||j==6){aDay.weekend=true}
aDay.jp_rows=jp_rows;aDay.inrow=i+1;aDay.value=indexDay;if(_isShowLunar){aDay.china=jp_templates.lunar_Info(getSolarDate(aDay.year,aDay.month+1,aDay.date,false))}else{aDay.china=jp_templates.lunar_Info(aDay.value)}
week.push(aDay);days++}
indexDay=jp_makeCal.addTime(indexDay,1,"day")}
jp_calData.push(week)}
if(_isShowLunar){var solarDate=getSolarDate(monthFirstD.getFullYear(),monthFirstD.getMonth()+1,monthFirstD.getDate(),false);var sWeek=solarDate.getDay();var lWeek=monthFirstD.getDay();if(sWeek==lWeek){return}else{if(sWeek==0){sWeek=7}
if(lWeek==0){lWeek=7}
if(lWeek<sWeek){for(var i=0;i<7-(lWeek-sWeek);i++){jp_calData[0].unshift(null);_selectDateIJ.j++;if(_selectDateIJ.j/7==1){_selectDateIJ.i++}
_selectDateIJ.j=_selectDateIJ.j%7}}else{for(var i=0;i<sWeek+7-lWeek;i++){jp_calData[0].unshift(null);_selectDateIJ.j++;if(_selectDateIJ.j/7==1){_selectDateIJ.i++}
_selectDateIJ.j=_selectDateIJ.j%7}}
var nowcalData=[];var week=[];var index=0;for(var i=0;i<jp_calData.length;i++){for(var j=0;j<jp_calData[i].length;j++){index++;week.push(jp_calData[i][j]);if(index%7==0){nowcalData.push(week);week=[]}}}
if(week.length>0){nowcalData.push(week);delete week}
if(nowcalData[0][6]==null){nowcalData.shift();_selectDateIJ.i--}
jp_calData=[];jp_calData=nowcalData}}},showCal:function(selectDate){if(typeof(selectDate)=="undefined"){selectDate=date=jp_makeCal.setTimeZero(new Date())}
$("#jptoday_button").removeClass("today_button");selectDate=jp_makeCal.setTimeZero(selectDate);$("#jpmonth_num").text((selectDate.getMonth()+1+"").leftpad(2));$("#jpyear_num").text(selectDate.getFullYear());var table="<table>       <thead class='tablehead'>        <tr>         <td class='thead'>一</td>         <td class='thead'>二</td>         <td class='thead'>三</td>         <td class='thead'>四</td>         <td class='thead'>五</td>         <td class='thead'>六</td>         <td class='thead'>日</td>        </tr>       </thead>       <tbody>";var tdclass="";for(var i=0;i<jp_calData.length;i++){var aWeek="<tr>";for(var j=0;j<7;j++){var tdclass="";if(jp_calData[i][j]==null||jp_calData[i][j]==undefined){aWeek+="<td></td>"}else{var datestr=getMonthDateStr(jp_calData[i][j].value);if(jp_calData[i][j].today==true){tdclass="today";$("#jptoday_button").addClass("today_button")}
var numtype="number";if(j==5||j==6){numtype="weekendNum"}
var isClickBlock="";if(jp_calData[i][j].today==false&&jp_calData[i][j].value.getTime()==selectDate.getTime()){isClickBlock=" clickBlock";_selectDateIJ.i=i;_selectDateIJ.j=j}
var aDay="<td i="+i+" j="+j+" class='block "+tdclass+isClickBlock+"'>";aDay+="<div class='block_content'>";if(_isShowLunar){var number=jp_calData[i][j].date;if(i>1&&(jp_calData[i][j].date==1||jp_calData[i][j].date==2)){number=monthDays(selectDate.getFullYear(),selectDate.getMonth())-number}
aDay+='<div class="'+numtype+'">'+cDay(number)+'</div><div class="number none">'+jp_calData[i][j].date+"</div>"}else{aDay+='<div class="'+numtype+'">'+jp_calData[i][j].date+'</div><div class="number none">'+jp_calData[i][j].china.l_day+"</div>"}
aDay+="</div></td>";aWeek+=aDay}}
aWeek+="</tr>";table+=aWeek}
table+="</tbody></table>";$("#jp_mainCal").empty();$("#jp_mainCal").append(table);jp_makeCal.makeAction()},initAction:function(){$(".jp_content #nextBtn_a").bind("click",function(e){var month=jp_currentDate.getMonth();var year=jp_currentDate.getFullYear();var real_show_month=jp_madeRiliDate.getMonth();month=real_show_month;month++;if(month>11){month=0;year++}
var currentMonth=real_show_month;jp_currentDate=jp_makeCal.addTime(jp_currentDate,1,"month");if(jp_currentDate.getMonth()!=(currentMonth+1)%12){jp_currentDate.setDate(1);jp_currentDate.setMonth(currentMonth+1)}
jp_makeCal.nextMonth(jp_currentDate)});$(".jp_content #prevBtn_a").bind("click",function(e){var month=jp_currentDate.getMonth();var year=jp_currentDate.getFullYear();var real_show_month=jp_madeRiliDate.getMonth();month=real_show_month;month--;if(month<0){month=11;year--}
var currentMonth=real_show_month;jp_currentDate=jp_makeCal.addTime(jp_currentDate,-1,"month");if(jp_currentDate.getMonth()!=(currentMonth+11)%12){jp_currentDate.setDate(1);jp_currentDate.setMonth((currentMonth+11)%12)}
jp_makeCal.prevMonth(jp_currentDate)});$("#jptoday_button").bind("click",function(e){if(!$(this).hasClass("today_button")){jp_makeCal.showToday()}});var indiv=false;var inhuangli=false},makeAction:function(){$(".jp_content .block").bind("click",function(e){var real_show_month=jp_madeRiliDate.getMonth();ele=$(e.target);while(1){if(ele.hasClass("block")){break}else{ele=ele.parent()}}
$(".jp_content .block").removeClass("clickBlock");click_date=jp_calData[ele.attr("i")][ele.attr("j")].value;_selectDateIJ.i=ele.attr("i");_selectDateIJ.j=ele.attr("j");if(click_date.getMonth()==(real_show_month+11)%12){jp_makeCal.prevMonth(click_date);return}
if(ele.hasClass("today")==false){ele.addClass("clickBlock")}
jp_makeCal.makeHuangli(jp_calData[ele.attr("i")][ele.attr("j")].value)})},makeHuangli:function(date){jp_currentDate=date;if(_isShowLunar){date=getSolarDate(date.getFullYear(),date.getMonth()+1,date.getDate(),false)}
date=jp_makeCal.setTimeZero(date);var datestr=date.getDate();var lunar=jp_templates.lunar_Info_detail(date);var gregorianDayStr=date.getFullYear()+"年 "+(date.getMonth()+1)+"月 ";gregorianDayStr+=datestr+"日";$(".jp_content").find("#gregorianDayStr").text(gregorianDayStr);var nowDate=jp_makeCal.setTimeZero(new Date());var nowMiliSecond=nowDate.getTime();var targetMiliSecond=date.getTime();var passedTime=Math.ceil((targetMiliSecond-nowMiliSecond)/86400000);var dayafterorbeforeStr="";if(nowDate.getDate()==date.getDate()){dayafterorbeforeStr="今天"}
if(passedTime<0){dayafterorbeforeStr=(0-passedTime)+"天前"}else{if(passedTime>0){dayafterorbeforeStr=passedTime+"天后"}}
if(date.getFullYear()==2012&&(date.getMonth()==0&&date.getDate()<23)){lunar.lunar=lunar.lunar.replace("龙","兔")}
if(date.getFullYear()==2013&&(date.getMonth()==0||(date.getMonth()==1&&date.getDate()<10))){lunar.lunar=lunar.lunar.replace("蛇","龙")}
$(".jp_content").find("#chinaDay").text(lunar.lunar)},getWeekFirst:function(date){var day=date.getDay();if(day==0){day=7}
return jp_makeCal.addTime(date,0-day+1,"day")},getMonthFirst:function(date){ndate=new Date(date);ndate.setDate(1);return ndate},addTime:function(date,inc,mode){ndate=new Date(date);switch(mode){case"day":ndate.setDate(date.getDate()+inc);break;case"week":ndate.setDate(date.getDate()+7*inc);break;case"month":ndate.setMonth(date.getMonth()+inc);break;case"year":ndate.setYear(date.getFullYear()+inc);break;case"hour":ndate.setHours(date.getHours()+inc);break;case"minute":ndate.setMinutes(date.getMinutes()+inc);break;default:return ndate}
return ndate},setTimeZero:function(date){ndate=new Date(date);ndate.setHours(0);ndate.setMinutes(0);ndate.setSeconds(0);ndate.setMilliseconds(0);return ndate},createDay:function(){obj=new Object();obj.year=0;obj.month=0;obj.date=0;obj.day=0;obj.before=false;obj.after=false;obj.weekend=false;obj.china=null;obj.rows=0;obj.inrow=0;obj.today=false;obj.value=null;obj.hasWork=false;return obj},nextMonth:function(clickDate){jp_makeCal.pareData(clickDate);jp_makeCal.showCal(clickDate);jp_showingToday=false;jp_makeCal.makeHuangli(clickDate)},prevMonth:function(clickDate){jp_makeCal.pareData(clickDate);jp_makeCal.showCal(clickDate);jp_showingToday=false;jp_makeCal.makeHuangli(clickDate)},showLunar:function(clickDate){jp_makeCal.pareData(clickDate);jp_makeCal.showCal(clickDate);jp_makeCal.makeHuangli(clickDate)},showCalendar:function(clickDate){jp_makeCal.pareData(clickDate);jp_makeCal.showCal(clickDate);jp_makeCal.makeHuangli(clickDate)},showToday:function(){jp_currentDate=new Date();var selectDate=jp_currentDate;if(_isShowLunar){var lunar=new jp_Lunar(selectDate);selectDate.setFullYear(lunar.year);selectDate.setMonth(lunar.month-1);selectDate.setDate(lunar.day);selectDate=jp_calander.setTimeZero(selectDate)}
jp_makeCal.pareData(selectDate);jp_makeCal.showCal(selectDate);jp_showingToday=true;jp_makeCal.makeHuangli(selectDate)}};var jp_templates={month_day:function(date){var d=date||new Date();return d.getDate()},lunar_Info:function(date){var cld=jp_cacheMgr.getCld(date.getFullYear(),date.getMonth());var day=date.getDate();var cld_day=cld[day-1];var lunar_detail={l_year:"",l_day:"",l_month:"",l_Numday:"",l_day_full:""};lunar_detail.l_day=cDay(cld_day.lDay);lunar_detail.l_Numday=cld_day.lDay;lunar_detail.l_month=cld_day.lMonth;lunar_detail.l_year=cld_day.lYear;lunar_detail.color="";return lunar_detail},lunar_Info_detail:function(date,callback){var cld=jp_cacheMgr.getCld(date.getFullYear(),date.getMonth());var year=date.getFullYear();var day=date.getDate();var cld_day=cld[day-1];var festival=[];var info={lunar:"",y_Info:"",huangliY:"无",huangliJ:"无"};var lunarYear=this.lunar_year(date);info.lunar=lunarYear+(cld_day.isLeap?"闰 ":"")+jp_templates.getChinaNum(cld_day.lMonth)+"月"+cDay(cld_day.lDay);info.y_Info=cld_day.cYear+"年"+lunarYear+" "+cld_day.cMonth+"月"+cld_day.cDay+"日";try{if(callback){callback(info)}}catch(e){}
return info},lunar_year:function(date){var l_year=Animals[(date.getFullYear()-4)%12]+"年";return l_year},getChinaNum:function(Num){var monthEn;switch(Num){case 1:monthEn="一";break;case 2:monthEn="二";break;case 3:monthEn="三";break;case 4:monthEn="四";break;case 5:monthEn="五";break;case 6:monthEn="六";break;case 7:monthEn="七";break;case 8:monthEn="八";break;case 9:monthEn="九";break;case 10:monthEn="十";break;case 11:monthEn="十一";break;case 12:monthEn="腊";break}
return monthEn}};function getMonthDateStr(date){month=date.getMonth()+1;day=date.getDate();if(month<10){month="0"+month}
if(day<10){day="0"+day}
return month+""+day}
function getFullDateStr(date){month=date.getMonth()+1;day=date.getDate();year=date.getFullYear();return year+"-"+month+"-"+day}
window.jp_makeCal=jp_calander;Date.prototype.format=function(format){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(format)){format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))}
for(var k in o){if(new RegExp("("+k+")").test(format)){format=format.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}
return format};var lunarInfo=new Array(19416,19168,42352,21717,53856,55632,21844,22191,39632,21970,19168,42422,42192,53840,53909,46415,54944,44450,38320,18807,18815,42160,46261,27216,27968,43860,11119,38256,21234,18800,25958,54432,59984,27285,23263,11104,34531,37615,51415,51551,54432,55462,46431,22176,42420,9695,37584,53938,43344,46423,27808,46416,21333,19887,42416,17779,21183,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,38310,38335,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,23232,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,20854,21183,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19195,19152,42192,53430,53855,54560,56645,46496,22224,21938,18864,42359,42160,43600,45653,27951,44448,19299,37759,18936,18800,25776,26790,59999,27424,42692,43759,37600,53987,51552,54615,54432,55888,23893,22176,42704,21972,21200,43448,43344,46240,46758,44368,21920,43940,42416,21168,45683,26928,29495,27296,44368,19285,19311,42352,21732,53856,59752,54560,55968,27302,22239,19168,43476,42192,53584,62034,54560);var solarMonth=new Array(31,28,31,30,31,30,31,31,30,31,30,31);var Gan=new Array("甲","乙","丙","丁","戊","己","庚","辛","壬","癸");var Zhi=new Array("子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥");var Animals=new Array("鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪");var sTermInfo=new Array(0,21208,42467,63836,85337,107014,128867,150921,173149,195551,218072,240693,263343,285989,308563,331033,353350,375494,397447,419210,440795,462224,483532,504758);var nStr1=new Array("日","一","二","三","四","五","六","七","八","九","十");var nStr2=new Array("初","十","廿","卅","□");var monthName=new Array("JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC");var cmonthName=new Array("正","二","三","四","五","六","七","八","九","十","十一","腊");function lYearDays(y){var i,sum=348;for(i=32768;i>8;i>>=1){sum+=(lunarInfo[y-1900]&i)?1:0}
return(sum+leapDays(y))}
function leapDays(y){if(leapMonth(y)){return((lunarInfo[y-1899]&15)==15?30:29)}else{return(0)}}
function leapMonth(y){var lm=lunarInfo[y-1900]&15;return(lm==15?0:lm)}
function monthDays(y,m){return((lunarInfo[y-1900]&(65536>>m))?30:29)}
function jp_Lunar(objDate){var i,leap=0,temp=0;var offset=(Date.UTC(objDate.getFullYear(),objDate.getMonth(),objDate.getDate())-Date.UTC(1900,0,31))/86400000;for(i=1900;i<2100&&offset>0;i++){temp=lYearDays(i);offset-=temp}
if(offset<0){offset+=temp;i--}
this.year=i;leap=leapMonth(i);this.isLeap=false;for(i=1;i<13&&offset>0;i++){if(leap>0&&i==(leap+1)&&this.isLeap==false){--i;this.isLeap=true;temp=leapDays(this.year)}else{temp=monthDays(this.year,i)}
if(this.isLeap==true&&i==(leap+1)){this.isLeap=false}
offset-=temp}
if(offset==0&&leap>0&&i==leap+1){if(this.isLeap){this.isLeap=false}else{this.isLeap=true;--i}}
if(offset<0){offset+=temp;--i}
this.month=i;this.day=offset+1}
function getSolarDate(lyear,lmonth,lday,isLeap){var offset=0;for(var i=1900;i<lyear;i++){offset+=lYearDays(i)}
for(var i=1;i<lmonth;i++){if(i==leapMonth(lyear)){offset+=leapDays(lyear)}
offset+=monthDays(lyear,i)}
if(isLeap){offset+=monthDays(lyear,i)}
offset+=parseInt(lday)-1;var baseDate=new Date(1900,0,31);var solarDate=new Date(baseDate.valueOf()+offset*86400000);return solarDate}
function solarDays(y,m){if(m==1){return(((y%4==0)&&(y0!=0)||(y%400==0))?29:28)}else{return(solarMonth[m])}}
function cyclical(num){return(Gan[num]+Zhi[num])}
function jp_calElement(sYear,sMonth,sDay,week,lYear,lMonth,lDay,isLeap,cYear,cMonth,cDay){this.isToday=false;this.sYear=sYear;this.sMonth=sMonth;this.sDay=sDay;this.week=week;this.lYear=lYear;this.lMonth=lMonth;this.lDay=lDay;this.isLeap=isLeap;this.cYear=cYear;this.cMonth=cMonth;this.cDay=cDay;this.color="";this.lunarFestival="";this.solarFestival="";this.solarTerms=""}
function sTerm(y,n){var offDate=new Date((31556925974.7*(y-1900)+sTermInfo[n]*60000)+Date.UTC(1900,0,6,2,5));return(offDate.getUTCDate())}
var jp_cMD=[];function jp_calendar(y,m){var sDObj,lDObj,lY,lM,lD=1,lL,lX=0,tmp1,tmp2,tmp3;var cY,cM,cD;var lDPOS=new Array(3);var n=0;var firstLM=0;sDObj=new Date(y,m,1,0,0,0,0);this.length=solarDays(y,m);this.firstWeek=sDObj.getDay();if(m<2){cY=cyclical(y-1900+36-1)}else{cY=cyclical(y-1900+36)}
var term2=sTerm(y,2);var firstNode=sTerm(y,m*2);cM=cyclical((y-1900)*12+m+12);var dayCyclical=Date.UTC(y,m,1,0,0,0,0)/86400000+25567+10;for(var i=0;i<this.length;i++){if(lD>lX){sDObj=new Date(y,m,i+1);lDObj=new jp_Lunar(sDObj);lY=lDObj.year;lM=lDObj.month;lD=lDObj.day;lL=lDObj.isLeap;lX=lL?leapDays(lY):monthDays(lY,lM);if(n==0){firstLM=lM}
lDPOS[n++]=i-lD+1}
if(m==1&&(i+1)==term2){cY=cyclical(y-1900+36)}
if((i+1)==firstNode){if(m==6){cM=cyclical((y-1900)*12+m+13);var mm=(y-1900)*12+m+13;var dd=dayCyclical+i;var month=(mm-2);var jianxing=(dd-month);var jiazi=dd%60;jp_cMD.push([mm,dd,jianxing,jiazi,cM,cyclical(dayCyclical+i)])}}else{if(m==6){var mm=(y-1900)*12+m+12;var dd=dayCyclical+i;var month=(mm-2);var jianxing=(dd-month);var jiazi=dd%60;jp_cMD.push([mm,dd,jianxing,jiazi,cM,cyclical(dayCyclical+i)])}}
cD=cyclical(dayCyclical+i);this[i]=new jp_calElement(y,m+1,i+1,nStr1[(i+this.firstWeek)%7],lY,lM,lD++,lL,cY,cM,cD)}}
function cDay(d){var s;switch(d){case 10:s="初十";break;case 20:s="二十";break;break;case 30:s="三十";break;break;default:s=nStr2[Math.floor(d/10)];s+=nStr1[d%10]}
return(s)}
$.dom=function(elementId){return document.getElementById(elementId)};function StringBuffer(){this._strings=new Array()}
StringBuffer.prototype.append=function(str){this._strings.push(str);return this};StringBuffer.prototype.toString=function(){var str=arguments.length==0?"":arguments[0];return this._strings.join(str)};String.prototype.leftpad=function(len,str){if(!str){str="0"}
var s="";for(var i=0;i<len-this.length;i++){s+=str}
return s+this};String.prototype.htmlspecialchars=function(){return this};function getMonthKey(year,month){return year.toString()+(month+1).toString().leftpad(2)}
function getDateKey(date){return date.getFullYear().toString()+"-"+(date.getMonth()+1).toString().leftpad(2)+"-"+date.getDate().toString().leftpad(2)}
function is_leap_year(cur_year){if(cur_year%400==0||(cur_year%100!=0&&cur_year%4==0)){return 1}
return 0}
function getDaysByMonth(date){var days=[[31,28,31,30,31,30,31,31,30,31,30,31],[31,29,31,30,31,30,31,31,30,31,30,31]];return days[is_leap_year(date.getFullYear())][date.getMonth()]}
var jp_cacheMgr={cldCache:{},getCld:function(year,month){var key=getMonthKey(year,month);var cld=this.cldCache[key];if(typeof cld=="undefined"){cld=new jp_calendar(year,month);this.cldCache[key]=cld}
return cld}};